# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```


## Данные и типы данных, используемых в приложении 

Все товары на главной странице

export interface IList {
  total: number;
  items: IItem[];
}

1 товар на главной странице

export type IItemPreview = Omit<IItem, 'description'>

Товар в модалке

export interface IItem {
  id: string;
  description: string;
  image: string;
  title: string;
  category: string;
  price: number | null;
}

Товар в корзине

export interface IBasketItem {
  id: string;
  title: string;
  price: number;
}

Все товары в корзине и их стоимость

export interface IBasket {
  items: IBasketItem[];
  total: number;
}

Строка инпута для адреса

export interface IAddress {
  address: string;
}

Форма почты и телефона

export interface IOrderForm {
  email: string;
  phone: string;
}

Сумма заказа

export interface IOrder {
  id: string;
  total: number;
}

Способ оплаты

export interface IPayment {
  method: string;
}

## Архитектура приложения

Код приложения разделен на слои согласно парадигме MVP:
-Слой модели — отвечает за хранение, обработку и управление данными.
-Слой представления — взаимодействует с пользователем.
-Слой презентера — связывает модель и представление, управляет логикой приложения.

### Базовый код

#### Класс Api
Содержит в себе базовую логику отправки запросов. В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.
Методы: 
- `get` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер
- `post` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.

#### Класс EventEmitter
Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.  
Основные методы, реализуемые классом описаны интерфейсом `IEvents`:
- `on` - подписка на событие
- `emit` - инициализация события
- `trigger` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие   


### Слой данных

#### Класс CatalogData
Класс отвечает за хранение и управление списком товаров.

Поля класса:

_items: IItem[] — массив товаров.
events: IEvents — экземпляр EventEmitter для событий.
Методы:

getAllItems(): IItem[] — возвращает список всех товаров.
getItem(itemId: string): IItem | undefined — получает товар по id.
setItems(items: IItem[]): void — загружает список товаров.

#### Класс BasketData

Управляет товарами в корзине.

Поля:

_items: IBasketItem[] — список товаров в корзине.
_total: number — общая стоимость товаров.
events: IEvents — экземпляр EventEmitter.
Методы:

addItem(item: IBasketItem): void — добавляет товар в корзину.
removeItem(itemId: string): void — удаляет товар из корзины.
getItems(): IBasketItem[] — возвращает список товаров.
calculateTotal(): void — обновляет сумму корзины.
clearBasket(): void — очищает корзину после оформления заказа.


#### Класс OrderData

Хранит данные заказа.

Поля:

_paymentMethod: string | null — способ оплаты.
_address: string | null — адрес доставки.
_email: string | null — email покупателя.
_phone: string | null — телефон покупателя.
events: IEvents — экземпляр EventEmitter.
Методы:

setPaymentMethod(method: string): void — устанавливает способ оплаты.
setAddress(address: string): void — сохраняет адрес доставки.
setContactInfo(email: string, phone: string): void — сохраняет email и телефон.
validateStepOne(): boolean — проверяет, введён ли адрес доставки.
validateStepTwo(): boolean — проверяет, заполнены ли email и телефон.


### Слой представления

#### Класс CatalogView

Отвечает за отображение каталога.

Методы:

renderItems(items: IItem[]): void — отображает список товаров.
openItemPreview(itemId: string): void — открывает модальное окно с товаром.

#### Класс BasketView

Управляет отображением корзины.

Методы:

renderBasket(items: IBasketItem[]): void — обновляет отображение корзины.
openBasket(): void — открывает корзину.

#### Класс OrderView

Отвечает за отображение формы оформления заказа.

Методы:

renderStepOne(): void — отображает выбор оплаты и адреса.
renderStepTwo(): void — отображает ввод email и телефона.
showValidationError(field: string): void — показывает ошибку.
showSuccessMessage(): void — показывает сообщение об успешной оплате.

#### Класс ModalView

Отвечает за управление модальными окнами.

Методы:

open(content: HTMLElement): void — открывает модальное окно с переданным контентом.
close(): void — закрывает модальное окно.

### Слой коммуникации

#### Класс AppApi
Принимает в конструктор экземпляр класса Api и предоставляет методы реализующие взаимодействие с бэкендом сервиса.

## Взаимодействие компонентов
Код, описывающий взаимодействие представления и данных между собой находится в файле `index.ts`, выполняющем роль презентера.\
Взаимодействие осуществляется за счет событий генерируемых с помощью брокера событий и обработчиков этих событий, описанных в `index.ts`\
В `index.ts` сначала создаются экземпляры всех необходимых классов, а затем настраивается обработка событий.

*Список всех событий, которые могут генерироваться в системе:*\
*События изменения данных (генерируются классами моделями данных)*

catalog:updated – обновление каталога товаров.
basket:updated – изменение корзины (добавление/удаление товара).
order:stepChanged – переход на следующий шаг оформления заказа.


*События, возникающие при взаимодействии пользователя с интерфейсом (генерируются классами, отвечающими за представление)*
Каталог товаров

product:open – открытие карточки товара в модальном окне.

Корзина

basket:open – открытие корзины.
basket:addItem – добавление товара в корзину.
basket:removeItem – удаление товара из корзины.

Оформление заказа

order:selectPayment – выбор способа оплаты.
order:inputAddress – ввод адреса доставки.
order:validateStepOne – проверка корректности данных первого шага.
order:inputContactInfo – ввод email и телефона.
order:validateStepTwo – проверка корректности второго шага.
order:submit – отправка заказа и очистка корзины.